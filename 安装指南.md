# MT-Free-Hunter 安装指南

## 飞牛 OS (fnOS) Docker 部署教程

本指南将手把手教你在飞牛 OS 的 NAS 上部署 MT-Free-Hunter，即使你是新手也能轻松完成！

---

## 目录

1. [准备工作](#1-准备工作)
2. [获取 M-Team API Token](#2-获取-m-team-api-token)
3. [获取 M-Team 用户 ID](#3-获取-m-team-用户-id)
4. [上传文件到 NAS](#4-上传文件到-nas)
5. [配置环境变量](#5-配置环境变量)
6. [启动 Docker 容器](#6-启动-docker-容器)
7. [访问 MT-Free-Hunter](#7-访问-mt-free-hunter)
8. [常见问题](#8-常见问题)

---

## 1. 准备工作

### 你需要准备：
- 一台运行飞牛 OS 的 NAS
- M-Team 账号（已注册）
- 电脑（用于配置）

### 确保 Docker 已安装：
1. 登录飞牛 OS 管理界面
2. 进入 **应用中心**
3. 搜索 **Docker** 并确保已安装
4. 如果没有安装，点击安装

---

## 2. 获取 M-Team API Token

这是最重要的一步！API Token 是程序访问 M-Team 的凭证。

### 步骤：

1. **登录 M-Team 网站**
   - 打开浏览器，访问 M-Team 网站
   - 使用你的账号密码登录

2. **进入控制面板**
   - 点击页面右上角的 **用户头像** 或 **用户名**
   - 选择 **控制面板** 或 **Control Panel**

3. **进入实验室**
   - 在控制面板左侧菜单中找到 **实验室** 或 **Laboratory**
   - 点击进入

4. **创建存取令牌**
   - 找到 **存取令牌** 或 **Access Token** 选项
   - 点击 **创建新令牌** 或 **Create New Token**
   - 给令牌起个名字，比如 "MT-Free-Hunter"
   - 点击确认创建

5. **复制令牌**
   - 创建成功后，会显示一串类似这样的字符：
     ```
     019b6020-30ea-737d-955c-xxxxxxxxxxxx
     ```
   - **立即复制并保存这个令牌！**
   - ⚠️ **重要：这个令牌只显示一次，关闭页面后无法再次查看！**
   - 建议先保存到记事本或备忘录中

---

## 3. 获取 M-Team 用户 ID

用户 ID 用于显示你的做种/下载状态（可选，但建议获取）。

### 步骤：

1. **登录 M-Team 网站**

2. **进入个人页面**
   - 点击你的 **用户名**
   - 进入个人资料页面

3. **查看 URL 获取 ID**
   - 看浏览器地址栏，URL 类似：
     ```
     https://kp.m-team.cc/userdetails.php?id=123456
     ```
   - 其中 `123456` 就是你的用户 ID
   - 记下这个数字

---

## 4. 上传文件到 NAS

### 方法一：使用飞牛 OS 文件管理器（推荐新手）

1. **解压文件**
   - 在电脑上解压 `MT-Free-Hunter.zip`
   - 你会得到一个 `MT-Free-Hunter` 文件夹

2. **登录飞牛 OS**
   - 打开浏览器，输入 NAS 的 IP 地址
   - 登录管理界面

3. **打开文件管理器**
   - 在飞牛 OS 桌面找到 **文件管理器** 或 **File Manager**
   - 点击打开

4. **选择上传位置**
   - 建议上传到 **docker** 文件夹或 **home** 目录
   - 例如：`/home/你的用户名/` 或 `/docker/`

5. **上传文件夹**
   - 点击 **上传** 按钮
   - 选择整个 `MT-Free-Hunter` 文件夹
   - 等待上传完成

### 方法二：使用 SSH（适合有经验的用户）

```bash
# 在电脑终端执行（需要替换 IP 和用户名）
scp -r MT-Free-Hunter 用户名@NAS的IP地址:~/
```

---

## 5. 配置环境变量

这一步是告诉程序你的 M-Team 账号信息。

### 步骤：

1. **找到配置文件**
   - 在 NAS 上打开 `MT-Free-Hunter` 文件夹
   - 找到 `.env.example` 文件

2. **复制并重命名**
   - 复制 `.env.example` 文件
   - 将副本重命名为 `.env`（注意：文件名就是 `.env`，前面有个点）

3. **编辑 .env 文件**
   - 用文本编辑器打开 `.env` 文件
   - 修改以下内容：

```env
# 把 your_api_token_here 替换成你在第2步获取的 API Token
MT_TOKEN=your_api_token_here

# 把这里替换成你在第3步获取的用户 ID（数字）
MT_USER_ID=123456

# 以下内容保持默认即可，不需要修改
MT_SITE_URL=https://kp.m-team.cc
REFRESH_INTERVAL=600
API_DELAY=1

# 对手用户ID（可选）- 用于在页面底部显示分享率对比
# 填写你想要比较的用户ID，留空则不显示对比
RIVAL_USER_ID=

# PushPlus Token（可选）- 用于微信推送预警
# 当下载中的种子免费即将到期或变为收费时推送通知
PUSHPLUS_TOKEN=
```

4. **保存文件**
   - 修改完成后保存文件
   - 确保文件名是 `.env`

### 示例：
如果你的 Token 是 `01abc234-56de-78fg-90hi-jklmnopqrstu`，用户 ID 是 `888888`，想要和用户 `999999` 比较分享率，并配置了 PushPlus Token，那么文件内容应该是：

```env
MT_TOKEN=01abc234-56de-78fg-90hi-jklmnopqrstu
MT_USER_ID=888888
MT_SITE_URL=https://kp.m-team.cc
REFRESH_INTERVAL=600
API_DELAY=1
RIVAL_USER_ID=999999
PUSHPLUS_TOKEN=your_pushplus_token_here
```

---

## 6. 启动 Docker 容器

### 方法一：使用飞牛 OS Docker 管理界面（推荐新手）

1. **打开 Docker 管理器**
   - 在飞牛 OS 应用中心找到并打开 **Docker** 应用

2. **使用 Compose 功能**
   - 找到 **Compose** 或 **编排** 功能
   - 点击 **新建** 或 **添加**

3. **选择 docker-compose.yml**
   - 浏览到 `MT-Free-Hunter` 文件夹
   - 选择 `docker-compose.yml` 文件

4. **启动服务**
   - 点击 **部署** 或 **启动**
   - 等待容器构建和启动（首次可能需要 1-2 分钟）

### 方法二：使用 SSH 命令行

1. **SSH 连接到 NAS**
   ```bash
   ssh 用户名@NAS的IP地址
   ```

2. **进入项目目录**
   ```bash
   cd ~/MT-Free-Hunter
   ```

3. **启动容器**
   ```bash
   # 如果有 sudo 权限
   sudo docker compose up -d

   # 或者（旧版本 Docker）
   sudo docker-compose up -d
   ```

4. **查看运行状态**
   ```bash
   sudo docker compose ps
   ```

   如果看到 `mt-free-hunter` 状态是 `Up`，说明启动成功！

---

## 7. 访问 MT-Free-Hunter

### 打开浏览器访问：

```
http://NAS的IP地址:5001
```

例如，如果你的 NAS IP 是 `192.168.1.100`，则访问：
```
http://192.168.1.100:5001
```

### 你应该能看到：
- 一个漂亮的深色界面
- 显示当前所有 Free 和 2xFree 种子
- 每个种子的剩余免费时间
- 你的做种/下载状态

---

## 8. 常见问题

### Q: 访问页面显示空白或无法连接？

**A:** 请检查：
1. 容器是否正常运行（在 Docker 管理器中查看状态）
2. 端口 5001 是否被占用
3. 防火墙是否允许 5001 端口

### Q: 页面显示 "未配置 MT_TOKEN"？

**A:** 说明 `.env` 文件没有正确配置：
1. 确认 `.env` 文件存在（不是 `.env.example`）
2. 确认 MT_TOKEN 的值已正确填写
3. 重启容器：
   ```bash
   sudo docker compose restart
   ```

### Q: API Token 报错 401？

**A:** Token 可能已失效：
1. 去 M-Team 网站重新生成一个新的 Token
2. 更新 `.env` 文件中的 MT_TOKEN
3. 重启容器

### Q: 为什么看不到成人区的免费种子？

**A:** 请确保你的 M-Team 账号已开启成人内容权限。

### Q: 如何更新程序？

**A:**
1. 下载新版本的文件
2. 替换 NAS 上的文件（保留 `.env` 文件）
3. 重新构建并启动：
   ```bash
   cd ~/MT-Free-Hunter
   sudo docker compose down
   sudo docker compose build --no-cache
   sudo docker compose up -d
   ```

### Q: 如何查看日志排查问题？

**A:**
```bash
sudo docker compose logs -f
```
按 `Ctrl+C` 退出日志查看。

### Q: 如何停止服务？

**A:**
```bash
cd ~/MT-Free-Hunter
sudo docker compose down
```

### Q: 如何修改刷新间隔？

**A:** 编辑 `.env` 文件，修改 `REFRESH_INTERVAL` 的值（单位：秒）：
- 600 = 10分钟
- 300 = 5分钟
- 900 = 15分钟

修改后需要重启容器。

---

## 功能说明

### 界面功能：
- **优惠类型筛选**：全部 / Free / 2xFree
- **大小筛选**：按种子大小过滤
- **做种人数筛选**：查找冷门或热门种子
- **剩余时间筛选**：快速找到即将过期的免费种子
- **状态筛选**：查看你正在做种或下载的种子
- **频道筛选**：综合区 / 成人区
- **收藏功能**：一键收藏感兴趣的种子
- **中英文切换**：支持中文和英文界面
- **深色/浅色主题**：保护眼睛
- **分享率对比**：与指定用户对比分享率（可选）
- **下载进度显示**：环形进度条显示下载进度
- **返回顶部按钮**：快速返回页面顶部
- **微信推送预警**：免费即将到期或变收费时推送通知（需配置 PushPlus）

### 响应式设计：
- **桌面端 (>1200px)**：完整表格布局，所有列正常显示
- **平板端 (769-1200px)**：表格支持横向滚动，列内容不换行
- **手机端 (<768px)**：卡片式布局，筛选栏随页面滚动

### 自动功能：
- 每 10 分钟自动刷新数据（可配置）
- 自动显示免费剩余时间倒计时
- 自动标记你的做种/下载状态

### 安全特性：
- XSS 攻击防护
- API 请求速率限制
- 输入验证
- 安全响应头
- Docker 非 root 用户运行

---

## 技术支持

如有问题，请检查：
1. 本指南的常见问题部分
2. Docker 容器日志
3. M-Team API Token 是否有效

---

**祝你使用愉快！** 🎉

---

# English Quick Installation Guide

## Prerequisites
- fnOS (or any Linux-based NAS) with Docker installed
- M-Team account

## Step 1: Get M-Team API Token
1. Login to M-Team website
2. Go to Control Panel → Laboratory → Access Token
3. Create and copy the token (save it immediately - shown only once!)

## Step 2: Get User ID
1. Click your username on M-Team
2. Check the URL: `userdetails.php?id=123456`
3. The number (123456) is your User ID

## Step 3: Upload Files
1. Extract `MT-Free-Hunter.zip`
2. Upload the folder to your NAS (e.g., `/home/username/MT-Free-Hunter/`)

## Step 4: Configure
1. Copy `.env.example` to `.env`
2. Edit `.env` with your token and user ID:
```env
MT_TOKEN=your_api_token
MT_USER_ID=your_user_id
RIVAL_USER_ID=optional_rival_id
PUSHPLUS_TOKEN=optional_pushplus_token
```

## Step 5: Start Docker
```bash
cd ~/MT-Free-Hunter
sudo docker compose up -d
```

## Step 6: Access
Open browser: `http://YOUR_NAS_IP:5001`

## Troubleshooting
- **Blank page**: Check if container is running with `sudo docker compose ps`
- **401 error**: Regenerate your API token
- **View logs**: `sudo docker compose logs -f`

For detailed instructions, please refer to the Chinese guide above or README.md.
